---
# front matter tells Jekyll to process Liquid
---
<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8" />
	<title>Warm spaces finder | Open Innovations</title>
	<link rel="stylesheet" href="assets/style.css">
	<link rel="icon" href="https://open-innovations.org/resources/images/logos/oi-square-13.svg" />
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="@OpenInnovates">
	<meta name="twitter:url" property="og:url" content="https://open-innovations.github.io/warm-spaces/">
	<meta name="twitter:title" property="og:title" content="Warm spaces finder">
	<meta name="twitter:description" property="og:description" content="Get a simple list of warm spaces near you.">
	<meta name="description" content="Search through {% include_relative data/nspaces.txt %} warm spaces from {% include_relative data/ndirs.txt %} directories.">
	<meta name="twitter:image" property="og:image" content="https://open-innovations.org/resources/images/logos/oi-square-13.png">
</head>
<body class="b1-bg">


	<div class="b6-bg">
		<header>
			<div class="b1-bg">
				<div class="holder padded" style="text-align:center;">
					<a href="https://open-innovations.org/"><svg width="100" height="100" overflow="auto" viewbox="-32 -32 64 64" xmlns="http://www.w3.org/2000/svg"><mask id="oi-person"><path d="m-32-32h64v64h-12v-24a4 4 0 0 0 -4 -4h-8a4 4 0 0 0 -4 4v24h-36zm44 27m-8 0a8 8 0 1 0 16 0 8 8 0 1 0-16 0" fill="#fff"></path></mask><g id="oi-logo" fill="#FF6700"><circle r="32" mask="url(#oi-person)"></circle></g></svg></a>
					<div class="title">Warm spaces finder</div>
				</div>
			</div>
		</header>
	</div>

	<div class="b6-bg">
		<div class="holder padded tallpadded">
			<div id="output">
				<div id="place-search">
					Find warm spaces 
					<form><label for="typeahead">by place:</label><input id="typeahead" type="text" placeholder="e.g. Leeds" autocomplete="off"></form>
					<div> or <button class="c13-bg" id="find">near my location</button></div>
				</div>
				<div><span class="jekyll-parse">Search {% include_relative data/nspaces.txt %}</span> warm spaces from <span class="jekyll-parse">{% include_relative data/ndirs.txt %}</span> different directories</div>
				<div id="key-holder">
					<ul id="key"><li class="c14-bg keyitem"><label for="key-opening-soon"><input type="checkbox" id="key-opening-soon" checked="checked" data="opening-soon" /> opening soon</label></li><li class="c13-bg keyitem"><label for="key-open"><input type="checkbox" id="key-open" checked="checked" data="open" /> open</label></li><li class="c12-bg keyitem"><label for="key-closing-soon"><input type="checkbox" id="key-closing-soon" checked="checked" data="closing-soon" /> closing soon</label></li><li class="b4-bg keyitem"><label for="key-closed"><input type="checkbox" id="key-closed" checked="checked" data="closed" /> closed</label></li><li class="b5-bg keyitem"><label for="key-unknown"><input type="checkbox" id="key-unknown" checked="checked" data="unknown" /> unknown</label></li></ul>
				</div>
			</div>
		</div>
	</div>
	<footer class="b1-bg">
		<div class="holder padded tallpadded">
			<h2>About</h2>
			<p>During the winter of 2022-3, the cost-of-living crisis in the UK means more-and-more people will struggle to stay warm. Several different groups have started collating different <a href="index.html">directories of warm spaces</a>. This duplicates work and means each directory only contains a subset of all warm spaces. Many of the directories are on pages that use quite a lot of data transfer which makes them less than ideal for those with limited data plans. For instance, Ofcom research from October 2021 estimated that 2 million households were "experiencing affordability issues with either their fixed broadband and/or smartphone" and we might expect there to be a large overlap between them and households struggling with the cost of heating. So we have developed this as a lower bandwidth tool that searches through multiple warm spaces directories from voluntary groups and local councils.</p>

			<h3>Data</h3>
			<p>This search includes <span class="jekyll-parse">{% include_relative data/nspaces.txt %}</span> warm spaces from <span class="jekyll-parse">{% include_relative data/ndirs.txt %}</span> directories that we were able to automatically collect and automatically parse (<a href="data/places.json">all parsed warm spaces as JSON</a>). As organisations can submit their warm space to multiple directories, there may be duplicates. If there are mistakes please refer back to the original source(s) and, if the mistakes are there, ask them to update those. If the mistake is only present in our version but not the original <a href="mailto:hello@open-innovations.org?subject=Warm Spaces Finder">let us know</a> so we can check our parsers. If you have a warm space that isn't included here then please refer to the <a href="index.html">directories of warm spaces</a> (<a href="data/sources.json">as JSON</a>) and choose an appropriate source to register with.</p>
			<p>We've also made it possible to get a list of all the <a href="by-area.html#LAD">warm spaces within each local authority</a> or <a href="by-area.html#PCON">warm spaces within each UK Parliamentary constituency</a>.</p>
			
			<h3>Opening times</h3>
			<p>Please note that <em>our display of opening times may not always be correct</em>. This is because the original data sources have allowed people to provide opening hours as unstructured free-text. There are hundreds of ways that organisations have chosen to write their opening hours and some choices of formatting make it very <a href="https://github.com/open-innovations/warm-spaces/actions/runs/3637587054/jobs/6138765472#step:4:6">hard for our code to work it out correctly</a>. The indications of opening given in this tool are therefore our automated best attempt to work them out. We're doing pretty well at it but have also provided a view of the original text for each. You can also check against the original sources. We suggest that people/organisations/directories use <a href="https://wiki.openstreetmap.org/wiki/Key:opening_hours">an existing standard format for opening times</a> such as the one developed by Open Street Map when adding data to the various directories. That way it will be easier to check for certain kinds of data entry mistake.</p>
			
			<h3>Location &amp; privacy</h3>
			<p>For the best results, the "near my location" button should work best. That uses your device's location (if you let it). We could have just sent that to our server to find the nearest warm spaces to your location but we decided to do as much as we can to respect your privacy whilst still being useful. If you do allow your location to be used, it is rounded to the nearest ~5km&times;2.5km grid cell and then all the warm spaces for that cell (and some neighbouring ones just in case you are on the edge of a grid cell) are loaded. This rounding ensures that your exact location doesn't leave this page so we (or our server) won't get to know what it is. Once the results are sent back to this page, your precise location is then used (in the page) to order the results.</p>
			<p>Some people, understandably, turn location services off on their device or block their browser from having access to that. In that case the "near my location" button obviously can't function. So we've also added a place search. Again, we could have taken the easy approach of sending what you type off to our server (or someone else's) to work out where that place is. But, instead, we've taken open data published by Ordnance Survey about place names, and then grouped those by first letter. So when you start typing, all our server needs to know is the first letter. This means a larger data usage than just passing full place name you've entered and returning a location, but felt reasonable to protect your privacy.</p>
			<p>If you use the place name search then the distance we show on the search results will be from the Ordnance Survey centre of the place to the warm space. So, if you've searched for a large place like "Leeds" the distances and ordering will probably not be correct for you. We've included cities, towns, suburban areas, villages, and hamlets from the Ordnance Survey data so hopefully there is something close enough to you to be useful.</p>
			
			<h3>Credits</h3>
			<p>This tool was created by Stuart Lowe, <a href="https://open-innovations.org/">Open Innovations</a>.</p>
			<p>The results come from various <a href="index.html">directories of warm spaces</a>; each result links back to the specific source directory that it came from. The original data has been contributed by individuals/organisations to those directories.</p>
			<p>The place name search uses a subset of processed data from <a href="https://www.ordnancesurvey.co.uk/business-government/products/open-map-names">Ordnance Survey's Open Names</a> released under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">Open Government Licence</a> and is &copy; Crown copyright and database right 2021 / Royal Mail data &copy; Royal Mail copyright and database right 2021 / National Statistics data &copy; Crown copyright and database right 2021.</p>
			<p>We have <a href="https://odileeds.github.io/Postcodes2LatLon/">derived locations from postcodes</a> for <span class="jekyll-parse">{% include_relative data/ngeocoded.txt %}</span> warm spaces using the <a href="http://geoportal.statistics.gov.uk/items/national-statistics-postcode-lookup-august-2018">ONS postcode lookup</a> which is derived from Code-Point® Open and <a href="https://www.ons.gov.uk/methodology/geography/licences">released under the Open Government Licence</a>.</p>
			
			<hr class="about" />
			<ul class="elsewhere">
				<li class="instagram"><a href="https://www.instagram.com/openinnovates/"><svg width="48" height="48" version="1.1" viewbox="83 -108.9 64 64" aria-labelledby="icon-instagram"><title id="icon-instagram">Instagram</title><path d="m115-100.9c-6.5181 0-7.3361 0.0285-9.8961 0.145-2.555 0.117-4.299 0.5215-5.8251 1.115-1.5785 0.61301-2.9175 1.433-4.2515 2.7675-1.335 1.334-2.155 2.673-2.77 4.251-0.59501 1.5265-1 3.271-1.115 5.8251-0.1145 2.56-0.1445 3.3785-0.1445 9.8966 0 6.5181 0.029 7.3336 0.145 9.8936 0.1175 2.555 0.52201 4.299 1.115 5.8251 0.61351 1.5785 1.4335 2.9175 2.768 4.2515 1.3335 1.335 2.6725 2.157 4.25 2.77 1.527 0.5935 3.2715 0.99801 5.8261 1.115 2.56 0.1165 3.3775 0.145 9.8951 0.145 6.5186 0 7.3341-0.0285 9.8941-0.145 2.555-0.117 4.301-0.52151 5.828-1.115 1.578-0.61301 2.915-1.435 4.2486-2.77 1.335-1.334 2.155-2.673 2.77-4.251 0.59-1.5265 0.99501-3.271 1.115-5.8251 0.11494-2.56 0.145-3.376 0.145-9.8941 0-6.5181-0.03-7.3361-0.145-9.8961-0.12002-2.555-0.52501-4.299-1.115-5.8251-0.615-1.5785-1.435-2.9175-2.77-4.2515-1.335-1.335-2.67-2.155-4.25-2.7675-1.53-0.59351-3.275-0.99801-5.8301-1.115-2.56-0.1165-3.375-0.145-9.8951-0.145zm-2.153 4.325c0.63902-1e-3 1.352 0 2.153 0 6.4081 0 7.1676 0.023 9.6981 0.138 2.34 0.107 3.61 0.49801 4.456 0.82651 1.12 0.43501 1.9185 0.95501 2.758 1.795 0.84 0.84001 1.36 1.64 1.796 2.76 0.32851 0.84501 0.72 2.115 0.82651 4.455 0.11494 2.53 0.14 3.29 0.14 9.6951 0 6.4051-0.025 7.1651-0.14 9.6951-0.10701 2.34-0.498 3.61-0.82651 4.455-0.435 1.12-0.95602 1.9175-1.796 2.757-0.84001 0.84001-1.6375 1.36-2.758 1.795-0.84501 0.33-2.116 0.72001-4.456 0.82701-2.53 0.11501-3.29 0.14-9.6981 0.14-6.4086 0-7.1681-0.025-9.6981-0.14-2.34-0.108-3.61-0.499-4.4565-0.82751-1.12-0.435-1.92-0.95501-2.76-1.795-0.84001-0.84001-1.36-1.638-1.796-2.7585-0.32851-0.84501-0.72001-2.115-0.82651-4.455-0.11501-2.53-0.138-3.29-0.138-9.6991s0.023-7.1651 0.138-9.6951c0.107-2.34 0.498-3.61 0.82651-4.456 0.435-1.12 0.95601-1.92 1.796-2.76 0.84-0.84001 1.64-1.36 2.76-1.796 0.846-0.33 2.1165-0.72 4.4565-0.82751 2.214-0.1 3.072-0.13 7.5451-0.135zm14.964 3.985c-1.59 0-2.88 1.2885-2.88 2.879 0 1.59 1.29 2.88 2.88 2.88s2.88-1.29 2.88-2.88-1.29-2.88-2.88-2.88zm-12.811 3.365c-6.8066 0-12.325 5.5186-12.325 12.325 0 6.8066 5.5186 12.323 12.325 12.323 6.8066 0 12.323-5.5161 12.323-12.323 0-6.8066-5.5171-12.325-12.324-12.325zm0 4.325c4.418 0 8.0001 3.5815 8.0001 8.0001 0 4.418-3.582 8.0001-8.0001 8.0001-4.4186 0-8.0001-3.582-8.0001-8.0001 0-4.4185 3.5815-8.0001 8.0001-8.0001z" fill="#fff" stroke-width=".50001"></path></svg></a></li>
				<li class="github"><a href="https://github.com/open-innovations"><svg width="48" height="48" viewbox="83 -108.9 64 64" aria-labelledby="icon-github"><title id="icon-github">Github</title><path d="m 114.97,-100.9 c -13.24,0 -23.97,11.015 -23.97,24.606 0,10.874 6.867,20.096 16.4,23.349 1.19,0.225 1.63,-0.534 1.63,-1.183 0,-0.588 0,-2.527 0,-4.583 -6.66,1.487 -8.07,-2.901 -8.07,-2.901 -1.095,-2.842 -2.665,-3.598 -2.665,-3.598 -2.178,-1.527 0.166,-1.496 0.166,-1.496 2.409,0.17 3.669,2.534 3.669,2.534 2.14,3.762 5.62,2.674 6.98,2.044 0.22,-1.587 0.84,-2.674 1.52,-3.286 -5.32,-0.623 -10.917,-2.735 -10.917,-12.163 0,-2.689 0.937,-4.883 2.467,-6.605 -0.25,-0.625 -1.07,-3.128 0.24,-6.516 0,0 2,-0.661 6.59,2.524 1.9,-0.548 3.96,-0.819 5.99,-0.828 2.04,0 4.1,0.282 6,0.831 4.58,-3.188 6.58,-2.524 6.58,-2.524 1.31,3.391 0.49,5.891 0.24,6.513 1.55,1.722 2.47,3.916 2.47,6.605 0,9.452 -5.6,11.534 -10.94,12.145 0.86,0.762 1.62,2.258 1.62,4.554 0,3.288 0,5.94 0,6.751 0,0.655 0.44,1.422 1.65,1.182 9.52,-3.259 16.38,-12.481 16.38,-23.349 0,-13.591 -10.73,-24.606 -23.97,-24.606 z" fill="white"></path></svg></a></li>
				<li class="facebook"><a href="https://www.facebook.com/ODILeedsCityRegion"><svg width="48" height="48" viewbox="83 -108.9 64 64" aria-labelledby="icon-facebook"><title id="icon-facebook">Facebook</title><rect style="opacity:0;fill:#eeeeee;fill-opacity:1;stroke:none;stroke-width:0.5;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" width="64" height="64" x="83" y="-108.9"></rect><path d="m 109.91,-52.9 0,-21.894 -7.37,0 0,-8.533 7.37,0 0,-6.297 c 0,-7.305 4.45,-11.276 10.97,-11.276 3.12,0 5.81,0.24 6.58,0.33 l 0,7.634 -4.52,0 c -3.53,0 -4.23,1.689 -4.23,4.145 l 0,5.442 8.44,0 -1.1,8.533 -7.34,0 0,21.894 -8.8,0.02 z" fill="#ffffff"></path></svg></a></li>
				<li class="twitter"><a href="https://twitter.com/OpenInnovates"><svg width="48" height="48" viewbox="83 -108.9 64 64" aria-labelledby="icon-twitter"><title id="icon-twitter">Twitter</title><g transform="matrix(0.16107,0,0,0.16107,3.9922,-188.2)" fill="#ff0000"><path d="m 633.9,812.04 c 112.46,0 173.96,-93.17 173.96,-173.96 0,-2.65 -0.1,-5.28 -0.17,-7.9 11.94,-8.63 22.31,-19.4 30.5,-31.66 -10.96,4.87 -22.75,8.14 -35.12,9.62 12.63,-7.57 22.32,-19.54 26.89,-33.81 -11.81,7 -24.89,12.09 -38.82,14.84 -11.16,-11.89 -27.04,-19.32 -44.63,-19.32 -33.77,0 -61.15,27.38 -61.15,61.13 0,4.8 0.54,9.47 1.59,13.94 -50.82,-2.55 -95.88,-26.88 -126.03,-63.88 -5.25,9.04 -8.28,19.53 -8.28,30.73 0,21.21 10.79,39.94 27.21,50.9 -10.03,-0.31 -19.46,-3.07 -27.69,-7.65 0,0.26 0,0.51 0,0.78 0,29.61 21.07,54.33 49.05,59.93 -5.14,1.4 -10.54,2.16 -16.12,2.16 -3.94,0 -7.77,-0.39 -11.49,-1.11 7.78,24.3 30.35,41.97 57.11,42.47 -20.92,16.4 -47.28,26.17 -75.93,26.17 -4.93,0 -9.8,-0.28 -14.59,-0.85 27.06,17.35 59.19,27.47 93.72,27.47" fill="#ffffff"></path></g></svg></a></li>
				<li class="youtube"><a href="https://www.youtube.com/channel/UCpZjukwfBCIgu91L3ynAJmg"><svg width="48" height="48" viewbox="83 -108.9 64 64" aria-labelledby="icon-youtube"><title id="icon-youtube">YouTube</title><g transform="matrix(0.67788,0,0,0.67788,3.418,-93.847)" fill="#ffffff"><path d="m 157.3,14.3 16.8,11.2 2.4,-1.2 -19.2,-10 z" style="opacity:0.12" fill="#ffffff"></path><g fill="#ffffff"><path d="m 199.3,10.8 c 0,0 -0.7,-4.9 -2.8,-7 -2.7,-2.8 -5.7,-2.8 -7.1,-3 -9.9,-0.7 -24.8,-0.7 -24.8,-0.7 0,0 -14.9,0 -24.8,0.7 -1.4,0.2 -4.4,0.2 -7.1,3 -2.1,2.1 -2.8,7 -2.8,7 0,0 -0.7,5.7 -0.7,11.5 l 0,5.4 c 0,5.7 0.7,11.5 0.7,11.5 0,0 0.7,4.9 2.8,7 2.7,2.8 6.2,2.7 7.8,3 5.7,0.5 24.1,0.7 24.1,0.7 0,0 14.9,0 24.8,-0.7 1.4,-0.2 4.4,-0.2 7.1,-3 2.1,-2.1 2.8,-7 2.8,-7 0,0 0.7,-5.7 0.7,-11.5 l 0,-5.4 c 0.1,-5.7 -0.7,-11.5 -0.7,-11.5 z m -42,23.4 0,-19.9 19.1,10 -19.1,9.9 z" fill="#ffffff"></path></g></g></svg></a></li>
			</ul>
			<p>Thanks to our sponsors, <a href="https://open-innovations.org/services/sponsors/">they help fund us to deliver and collaborate</a>.</p>
			<div class="address">
				<a href="https://open-innovations.org/location/">Open Innovations, 3rd Floor, Munro House, Duke Street, Leeds LS9 8AG</a>				| <a href="https://find-and-update.company-information.service.gov.uk/company/09417733">09417733</a>
				<br><a href="https://open-innovations.org/contact/">Contact us</a> | <a href="https://open-innovations.org/terms">Terms of use</a> | <a href="https://open-innovations.org/privacy">Privacy policy</a> | <a href="https://open-innovations.org/cookies">Cookie policy</a>
				<br><a href="http://creativecommons.org/licenses/by/4.0/">© CC BY 4.0 Open Innovations 2022</a>
			</div>
		</div>
	</footer>

	<script src="assets/warmspaces.js"></script>
	<script>
	var finder;
	OI.ready(function(){
		finder = OI.WarmSpacesFinder({
			'el': document.getElementById('output'),
			'sources': 'data/sources.json',
			'tiles': {
				'url': 'data/tiles/{z}/{x}/{y}.geojson',
				'zoomLevels': [10],
				'limits': {'N':58.6350001085,'S':49.959999905,'E':1.68153079591,'W':-7.57216793459},
			}
		});
	});
	</script>
	<style>
	#place-search > * { display: inline-block; line-height: 3em; }
	.typeahead { line-height: 2.5em; }
	#typeahead { height: 2.5em; font-size: inherit; margin-left: 0.25em; margin-right: 0.25em; }
	#find { line-height: 1.5em; margin-left: 0.25em; border-radius:4px; }
	.typeahead-results { z-index: 1000; max-width: unset!important; }
	.typeahead-results ol { list-style: none; background: #efefef; line-height: 1.25em; }
	.typeahead-results ol > li { text-align: left; white-space: nowrap; }
	.typeahead-results ol > li.selected { background: #444; color: white; }
	.typeahead-results ol > li > a { display: block; padding: 0.5em 0.5em; text-decoration: none; }
	</style>
	<script>
	/*!
		Typeahead search v0.1.8
	*/
	!function(e){void 0===e.TypeAhead&&(e.TypeAhead=new function(){return this.version="0.1.8",this.init=function(e,t){return new function(e,t){if(t||(t={}),"string"==typeof e&&(e=document.querySelector(e)),!e)return console.warn("No valid element provided"),this;var n,o,i=this,a={},r=t.items||[],s="boolean"==typeof t.inline&&t.inline;function l(){return n?n.querySelectorAll("li"):[]}function f(o){o&&(i.input=e,"function"==typeof t.process?t.process.call(i,r[o]):console.log(r[o])),n&&(n.innerHTML=""),s&&(e.style.marginBottom="0px")}function c(){for(var e=l(),t=0;t<e.length;t++)if(e[t].classList.contains("selected"))return f(e[t].getAttribute("data-id"))}return this.update=function(){var t=document.createEvent("HTMLEvents");return t.initEvent("keyup",!1,!0),e.dispatchEvent(t),this},this.on=function(u,d,p){return e?("change"==u?(a[u]||(a[u]=[],e.addEventListener("keyup",function(d){d.preventDefault(),d.stopPropagation(),40==d.keyCode||38==d.keyCode?function(e){for(var t,n=l(),o=-1,i=0;i<n.length;i++)n[i].classList.contains("selected")&&(o=i);t=o,40==e?o++:o--,o<0&&(o=n.length-1),o>=n.length&&(o=0),t>=0&&n[t].classList.remove("selected"),n[o].classList.add("selected")}(d.keyCode):13==d.keyCode?c():(function(c,u,d){var p,h,y,v,g,m,k;if(v=c.toUpperCase(),y=[],v){for(h=0;h<r.length;h++)m={rank:0,key:h,value:r[h]},"function"==typeof t.rank?m.rank=t.rank(r[h],c):(0==r[h].toUpperCase().indexOf(v)&&(m.rank+=3),r[h].toUpperCase().indexOf(v)>0&&(m.rank+=1)),y.push(m);y=function(e,t){return e.sort(function(e,n){return e[t]<n[t]?1:-1})}(y,"rank")}if(n||(e.parentElement.style.position="relative",(n=document.createElement("div")).classList.add("typeahead-results"),n.style.top=e.offsetTop+e.offsetHeight+"px",n.style.left=e.offsetLeft+"px",n.style.maxWidth=e.parentElement.offsetWidth-e.offsetLeft-parseInt(window.getComputedStyle(e.parentElement,null).getPropertyValue("padding-right"))+"px",n.style.position="absolute",o.style.position="relative",e.insertAdjacentElement("afterend",n)),g="",y.length>0){for(p="number"==typeof t.max?Math.min(y.length,t.max):y.length,g="<ol>",h=0;h<p;h++)y[h].rank>0&&(g+='<li data-id="'+y[h].key+'" '+(0==h?' class="selected"':"")+'><a tabindex="0" href="#" class="name item">'+("function"==typeof t.render?t.render(r[y[h].key]):r[y[h].key])+"</a></li>");g+="</ol>"}n.innerHTML=g,s&&(e.style.marginBottom=n.offsetHeight+"px");var b=l();for(h=0;h<b.length;h++)b[h].addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),f(this.getAttribute("data-id"))});if(a[d])for(u._typeahead=i,h=0;h<a[d].length;h++)k=a[d][h],u.data=k.data||{},"function"==typeof k.fn&&k.fn.call(k.data.this||this,u)}(this.value,d,u),"function"==typeof t.endsearch&&t.endsearch(this.value))}),e.addEventListener("blur",function(e){"function"==typeof t.blur&&t.blur()})),a[u].push({fn:p,data:d})):"blur"==u?console.log("blur"):console.warn("No event of type "+u),this):(console.warn("Unable to attach event "+u),this)},this.off=function(e,t){if(a[e])for(var n=0;n<a[e].length;n++)a[e][n].fn==t&&a[e].splice(n,1)},e.form&&(o=e.form).addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),c()},!1),e&&e.setAttribute("autocomplete","off"),this.addItems=function(e){r||(r=[]),r=r.concat(e)},this.clearItems=function(){r=[]},this.on("change",{},function(e){}),this}(e,t)},this})}(window||this);

	var inp = document.getElementById('typeahead');
	if(inp){
		document.getElementById('place-search').addEventListener('submit',function(e){ e.preventDefault(); e.stopPropagation(); });
		// Build the main search for places
		this.typeahead = TypeAhead.init(inp,{
			'items': [],
			'max': 8,	// Set a maximum number to list
			'render': function(d){
				// Construct the label shown in the drop down list
				return d.displayname;
			},
			'process': function(city){
				finder.setLocation(city.lat,city.lon);
			},
			'rank': function(d,str){
				// Calculate the weight to add to this airport
				var r = 0;
				var words,w;
				if(d){
					words = str.split(/[\s\,]/);
					if(typeof d.displayname==="string") r += getScore(d.displayname,str);
					if(typeof d.truename==="string") r += getScore(d.truename,str);
					for(w = 0; w < words.length; w++){
						if(words[w]){
							if(typeof d.displayname==="string") r += getScore(d.displayname,words[w]);
							if(typeof d.truename==="string") r += getScore(d.truename,words[w]);
						}
					}
					if(d.type=="c") r *= 5;
					if(d.type=="t") r *= 4;
					if(d.type=="o") r *= 3;
					if(d.type=="a") r *= 2;
					if(d.type=="v") r *= 2;
					//r *= d.population;
				}
				return r;
			}
		});

		inp.addEventListener('focus',function(e){
			e.currentTarget.value = "";
		});

		// Define a function for scoring how well a string matches
		function getScore(str1,str2,v1,v2,v3){
			var r = 0;
			str1 = str1.toUpperCase();
			str2 = str2.toUpperCase();
			if(str1.indexOf(str2)==0) r += (v1||3);
			if(str1.indexOf(str2)>0) r += (v2||1);
			if(str1==str2) r += (v3||4);
			return r;
		}
		var loading = {};
		// Attach a callback to the 'change' event. This gets called each time the user enters/deletes a character.
		this.typeahead.on('change',{'me':this.typeahead},function(e){
			var name = e.target.value.toLowerCase();
			var fl = name[0];
			if(fl && fl.match(/[a-zA-Z\'\`]/i)){
				if(!loading[fl]){
					var file = 'data/geo/ranked-'+fl+'.tsv';
					var _obj = e.data.me;

					fetch(file,{})
					.then(response => { return response.text(); })
					.then(d => {
						
						var data,l,c,header,cols,datum;
						d = d.replace(/\r/g,'').split(/[\n]/);
						data = new Array(d.length);
						header = ["truename","admin1","type","lat","lon"];
						for(l = 0; l < d.length; l++){
							cols = d[l].split(/\t/);
							datum = {};
							for(c = 0; c < cols.length; c++){
								datum[header[c]] = cols[c].replace(/(^\"|\"$)/g,"");
								// Convert numbers
								if(parseFloat(datum[header[c]])+"" == datum[header[c]]) datum[header[c]] = parseFloat(datum[header[c]]);
								datum.i = l;
								datum.displayname = datum.truename+(datum.admin1 ? ', '+datum.admin1+'':'');
							}
							data[l] = datum;
						}
						_obj.addItems(data);
					}).catch(error => {
						_obj.message('Unable to load file '+file,{'type':'ERROR','extra':{}});
					});
					loading[fl] = true;
				}
			}
		});
	}


	function loadBlock(i,block){
		let html = block.innerHTML;
		let file = "";
		html = html.replace(/\{\% include_relative (.*\.[a-zA-Z]*) \%\}/g,function(m,p1){
			file = p1;
			return "<div id=\"jekyll-"+i+"\"></div>";
		});
		block.innerHTML = html;
		if(file){
			fetch(file,{'i':i})
			.then(response => { return response.text(); })
			.then(text => {
				document.getElementById('jekyll-'+i).outerHTML = text;
			}).catch(error => {
				console.error('No file at '+file);
			});
		}
	}
	var blocks = document.getElementsByClassName('jekyll-parse');
	for(var i = 0; i < blocks.length; i++) loadBlock(i,blocks[i]);
	</script>

	<script src="https://open-innovations.org/resources/oi.log.js"></script>
	<script>
	OI.log.setup({'id':'odileeds','target':['open-innovations.github.io']}).add('action=view');
	</script>

</body></html>